<div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-23T11:54:03.404Z" title="2020-11-23T11:54:03.404Z">2020-11-23</time><span class="level-item">6 分钟 读完 (大约 942 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/11/23/ms17_010%EF%BC%88%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">ms17_010（永恒之蓝）漏洞利用</a></h1><div class="content"><h1 id="ms17-010（永恒之蓝）漏洞利用"><a href="#ms17-010（永恒之蓝）漏洞利用" class="headerlink" title="ms17_010（永恒之蓝）漏洞利用"></a>ms17_010（永恒之蓝）漏洞利用</h1><h2 id="1、MS17-010是什么"><a href="#1、MS17-010是什么" class="headerlink" title="1、MS17-010是什么"></a>1、MS17-010是什么</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MS17-010漏洞利用模块就是利用Windows系统的Windows SMB远程执行代码漏洞，</span><br><span class="line">向Microsoft服务器消息块（SMBv1）服务器发送经特殊设计的消息后，允许远程代码执行。</span><br><span class="line">成功利用这些漏洞的攻击者即可获得在目标系统上执行代码的权利。</span><br></pre></td></tr></table></figure>


<h2 id="2、准备虚拟机win7-64位和kali"><a href="#2、准备虚拟机win7-64位和kali" class="headerlink" title="2、准备虚拟机win7 64位和kali"></a>2、准备虚拟机win7 64位和kali</h2><p>查看win7虚拟机IP：</p>
<p><img src="https://img-blog.csdnimg.cn/20201119104430862.png#pic_center" alt="在这里插入图片描述"><br>kali IP：<br><img src="https://img-blog.csdnimg.cn/20201119104508485.png#pic_center" alt="在这里插入图片描述"></p>
<h2 id="3、对win7进行端口扫描"><a href="#3、对win7进行端口扫描" class="headerlink" title="3、对win7进行端口扫描"></a>3、对win7进行端口扫描</h2><p>使用kali的nmap工具进行扫描，在kali终端输入nmap –sS –sV –Pn 192.168.0.101即可进行扫描，-sS 是半开放扫描，比普通扫描要快,-sV是版本检测,-Pn是不对目标主机进行存活性判断，直接扫描，注意要把win7的防火墙关闭了，不然会被拦截</p>
<p><img src="https://img-blog.csdnimg.cn/20201119105235223.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>445端口开放。</p>
<h2 id="4、使用Metasploit-Framework工具"><a href="#4、使用Metasploit-Framework工具" class="headerlink" title="4、使用Metasploit Framework工具"></a>4、使用Metasploit Framework工具</h2><p>（1）搜索ms17_010漏洞利用模块<br><img src="https://img-blog.csdnimg.cn/20201119105743985.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>（2）先使用Auxiliaries辅助模块：auxiliary/scanner/smb/smb_ms17_010这个模块进行漏洞的分析，看看445端口是否能被入侵<br><img src="https://img-blog.csdnimg.cn/20201119110249320.png#pic_center" alt="在这里插入图片描述"><br>show options查看这个模块的选项，在Required那列中，yes的是必填的,no是选填的，默认帮我们已经写好了大部分的参数，但我们还是要手动设置一下RHOSTS的参数，即指定的主机ip，这里我们写被攻击的win7的ip<br><img src="https://img-blog.csdnimg.cn/20201119110331965.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>set RHOSTS 192.168.175.129<br><img src="https://img-blog.csdnimg.cn/20201119110427679.png#pic_center" alt="在这里插入图片描述"><br>接着输入run执行探测<br><img src="https://img-blog.csdnimg.cn/20201119110751987.png#pic_center" alt="在这里插入图片描述"><br>主机可能容易受到MS17-010的攻击！<br>这里就基本可以确认，ms17-010可以入侵该win7<br>（3）使用攻击模块<br><img src="https://img-blog.csdnimg.cn/20201119111008510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>使用这个模块，我们show targets看一下这个模块适用于哪些系统的主机<br><img src="https://img-blog.csdnimg.cn/20201119111033819.png#pic_center" alt="在这里插入图片描述"><br>可以看到,win7和server 2008 r2都适用<br>show options来看看有哪些选项</p>
<p><img src="https://img-blog.csdnimg.cn/20201119111103683.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>设置RHOST，即要攻击的主机ip即可<br>set RHOST 192.168.175.129<br><img src="https://img-blog.csdnimg.cn/20201119111142361.png#pic_center" alt="在这里插入图片描述"><br>接着run执行攻击<br><img src="https://img-blog.csdnimg.cn/20201119111216627.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>出现了win7的cmd，这是已经是渗透成功了。但有时候不一定会成功，会返回FAIL，说明这个系统打了补丁，这个漏洞已经没有威力了。<br>之后就可以建用户开端口了，渗透成功。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-23T11:54:03.401Z" title="2020-11-23T11:54:03.401Z">2020-11-23</time><span class="level-item">7 分钟 读完 (大约 1030 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/11/23/Metasploit%E5%AD%A6%E4%B9%A0%EF%BC%9A%20Samba%E6%9C%8D%E5%8A%A1%20usermap_script%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">Metasploit学习： Samba服务 usermap_script安全漏洞利用</a></h1><div class="content"><h1 id="Metasploit学习：-Samba服务-usermap-script安全漏洞利用"><a href="#Metasploit学习：-Samba服务-usermap-script安全漏洞利用" class="headerlink" title="Metasploit学习： Samba服务 usermap_script安全漏洞利用"></a>Metasploit学习： Samba服务 usermap_script安全漏洞利用</h1><h2 id="1、username-script-是什么"><a href="#1、username-script-是什么" class="headerlink" title="1、username_script 是什么"></a>1、username_script 是什么</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- Samba协议的一个漏洞CVE-2007-2447，用户名映射脚本命令执行</span><br><span class="line">- 影响Samba的3.0.20到3.0.25rc3 版本</span><br><span class="line">- 当使用非默认的用户名映射脚本配置选项时产生</span><br><span class="line">- 通过指定一个包含shell元字符的用户名，攻击者能够执行任意命令</span><br></pre></td></tr></table></figure>

<h2 id="2、如何利用"><a href="#2、如何利用" class="headerlink" title="2、如何利用"></a>2、如何利用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1、使用metasploit框架</span><br></pre></td></tr></table></figure>

<h2 id="3、漏洞时间线"><a href="#3、漏洞时间线" class="headerlink" title="3、漏洞时间线"></a>3、漏洞时间线</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">漏洞的时间线： </span><br><span class="line">- 2007年5月7日：漏洞匿名披露到security@samba.org电子邮件列表中。</span><br><span class="line">- 2007年5月7日：Samba的开发人员Gerald Carter开始响应这个漏洞。</span><br><span class="line">- 2007年5月9日：Samba的开发者Jeremy Allison发布了补丁，用于iDefense测试。</span><br><span class="line">- 2007年5月10日：向vendor-sec邮件列表发布通知。</span><br><span class="line">- 2007年5月14日：公开漏洞信息。</span><br></pre></td></tr></table></figure>

<h2 id="4、利用过程"><a href="#4、利用过程" class="headerlink" title="4、利用过程"></a>4、利用过程</h2><p>工具书：Web安全攻防渗透测试实战指南</p>
<p>首先查看靶机metasploitable的IP地址</p>
<p><img src="https://img-blog.csdnimg.cn/20201118200944986.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>对靶机进行扫描，收集可用的服务信息。使用nmap扫描并查看系统开放端口和相关的应用程序</p>
<p><img src="https://img-blog.csdnimg.cn/20201118201013109.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>收集到目标机相关信息后，选择正确的Exploit和Payload，扫描结果显示主机运行着Samba3.x服务。</p>
<p><strong>Samba是在Linux和UNIX系统上实现SMB (Server Messages Block,信息服务块)协议的一款免费软件。SMB是一种在局域网上共享文件和打印机的通信协议，它在局域网内使用Linux和Windows系统的机器之间提供文件及打印机等资源的共享服务。</strong></p>
<p>输入msf &gt; search samba 命令搜索Samba的漏洞利用模块，并选择合适的漏洞利用模块</p>
<p><img src="https://img-blog.csdnimg.cn/20201118201023412.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>Samba服务将返回漏洞利用模块的列表，因为exploit/multi/samba/usermap_script被标记为“Excellent”，选择此模块进行接下来的渗透。</p>
<p>查看漏洞详细信息可用如图命令：</p>
<p><img src="https://img-blog.csdnimg.cn/20201118201032743.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>使用该漏洞利用模块，并查看该漏洞利用模块下可供选择的攻击载荷模块。</p>
<p><img src="https://img-blog.csdnimg.cn/20201118201043255.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>选择基础的cmd/unix/reverse反向攻击载荷模块</p>
<p><img src="https://img-blog.csdnimg.cn/20201118201054191.png#pic_center" alt="在这里插入图片描述"></p>
<p>设置被攻击主机IP地址、该漏洞利用的端口号、发动攻击主机IP地址。</p>
<p><img src="https://img-blog.csdnimg.cn/20201118201101744.png#pic_center" alt="在这里插入图片描述"></p>
<p>再次确认参数是否已设置正确</p>
<p><img src="https://img-blog.csdnimg.cn/20201118201110144.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>设置完所有参数变量后，输入攻击命令exploit或者run，发动攻击。<br><img src="https://img-blog.csdnimg.cn/20201118201117193.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>MSF发动攻击成功后会获取目标主机的shell，验证该shell是目标主机可以查询主机名、用户名和IP地址。在攻击机和目标机之间建立了一个shell连接。</p>
<h2 id="图形化界面工具msfgui："><a href="#图形化界面工具msfgui：" class="headerlink" title="图形化界面工具msfgui："></a>图形化界面工具msfgui：</h2><p><a href="https://blog.csdn.net/qq_43968080/article/details/103544016">https://blog.csdn.net/qq_43968080/article/details/103544016</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-23T11:54:03.399Z" title="2020-11-23T11:54:03.399Z">2020-11-23</time><span class="level-item">2 分钟 读完 (大约 337 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/11/23/Metasploit%E6%8A%8Acommand%20shell%E8%BD%AC%E4%B8%BAmeterpreter%20shell/">Metasploit把command shell转为meterpreter shell</a></h1><div class="content"><h1 id="Metasploit把command-shell转为meterpreter-shell"><a href="#Metasploit把command-shell转为meterpreter-shell" class="headerlink" title="Metasploit把command shell转为meterpreter shell"></a>Metasploit把command shell转为meterpreter shell</h1><h2 id="获取command-shell"><a href="#获取command-shell" class="headerlink" title="获取command shell"></a>获取command shell</h2><p>使用metasploit工具，使用漏洞利用模块exploit/multi/samba/usermap_script拿到metasploitbale虚拟机的shell。<a href="https://blog.csdn.net/Karol_agan/article/details/109784575">(详细请点击)</a></p>
<p><img src="https://img-blog.csdnimg.cn/20201118200358301.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>这里的shell是普通的command shell</p>
<h2 id="shell转换"><a href="#shell转换" class="headerlink" title="shell转换"></a>shell转换</h2><p>ctrl+Z，选择y，则将当前shell放到后台。</p>
<p><img src="https://img-blog.csdnimg.cn/20201118200416972.png#pic_center" alt="在这里插入图片描述"></p>
<p>输入sessions -l(小写的L)查看当前活跃的sessions</p>
<p><img src="https://img-blog.csdnimg.cn/20201118200430355.png#pic_center" alt="在这里插入图片描述"></p>
<p>是刚才挂起的metasploitable的shell，当前的session id是2，执行下图命令<br>use post/multi/manage/shell_to_meterpreter<br><img src="https://img-blog.csdnimg.cn/20201119112720324.png#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20201118200444320.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0thcm9sX2FnYW4=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>再次输入sessions -l 查看后台的sessions</p>
<p><img src="https://img-blog.csdnimg.cn/20201118200457808.png#pic_center" alt="在这里插入图片描述"></p>
<p>多了一个Id为3的meterpreter shell，输入session -i 3,调用Id为3的shell,至此转换成功。</p>
<p><img src="https://img-blog.csdnimg.cn/20201118200512938.png#pic_center" alt="在这里插入图片描述"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-06-11T16:37:25.590Z" title="2020-06-11T16:37:25.590Z">2020-06-12</time><span class="level-item">1 分钟 读完 (大约 123 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/06/12/hello-world/">Hello World</a></h1><div class="content"><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
</div></article></div>